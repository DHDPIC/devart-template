<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>devart sphere</title>
		<link type="text/css" rel="stylesheet" href="/css/display.css">
	</head>
	<body>
		<div id="container"></div>

		<p id="orientation">Orientation<br>
	        alpha: <span class="alpha"></span><br>
	        beta: <span class="beta"></span><br>
	        gamma: <span class="gamma"></span>
        </p>
	</body>

	<script type="x-shader/x-vertex" id="textureGenerationVertex">
		varying vec2 vUv;

		void main() {
			vUv = vec2(uv.s, uv.t);
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		}
	</script>

	<script type="x-shader/x-fragment" id="textureGenerationFragment">
		uniform sampler2D uDeviceInputTexture;
		uniform sampler2D uSphereHeightMap1;
		uniform float uTime;
		uniform float uDelta;
		uniform vec2 uResolution;

		varying vec2 vUv;

		vec2 pixelCoords (vec2 texCoords, float width, float height) {
			vec2 p = vec2(0.0, 0.0);
			p.x = floor(texCoords.x / width);
			p.y = floor(texCoords.y / height);

			return p;
		}

		vec2 texCoords (vec2 pixelCoords, float width, float height, float halfPixelWidth, float halfPixelHeight) {
			vec2 t = vec2(0.0, 0.0);
			t.x = pixelCoords.x / width;
			t.y = pixelCoords.y / height;

			return t;
		}

		float map (float value, float sMin, float sMax, float dMin, float dMax) {
			return ((value / (sMax - sMin)) * (dMax - dMin)) + dMin;
		}

		void main () {
			vec4 color;
			vec4 data;
			vec2 uv = vUv;

			float width = uResolution.x;
			float height = uResolution.y;
			float pixelWidth = 1.0 / width;
			float halfPixelWidth = pixelWidth * 0.5;
			float pixelHeight = 1.0 / height;
			float halfPixelHeight = pixelHeight * 0.5;
			float alpha;
			float beta;
			float gamma;
			float active;
			float yp;
			float tolerance = pixelHeight;
			float diff;
			float speed = 1.0;
			float dy = pixelHeight;
			vec2 tc;

			if(vUv.t < (1.0 - dy)) {
				uv.t = vUv.t + dy;
				color = texture2D(uSphereHeightMap1, uv);
			}
			else {
				// only testing 1st coord right now
				//tc = texCoords (vec2(0.0, 0.0), width, height, halfPixelWidth, halfPixelHeight);
				data = texture2D(uDeviceInputTexture, vec2(0.0, 1.0));
				alpha = data.r;
				beta = data.g;
				gamma = data.b;
				active = data.a;
				yp = beta;

				diff = vUv.s - yp;

				if(active == 1.0 && abs(diff) < tolerance) {
					color = vec4(1.0, 0.0, 0.0, 0.0);
				}
				else {
					color = vec4(0.0, 0.0, 0.0, 1.0);
				}
			}

			gl_FragColor = color;
		}
	</script>

	<script type="x-shader/x-vertex" id="vertexshader">
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif

		uniform sampler2D bumpTexture;
		uniform float bumpScale;

		varying float vAmount;
		varying vec2 vUV;

		varying vec3 vNormal;


		void main()
		{
			vNormal = normal;
			vUV = uv;
			vec4 bumpData = texture2D(bumpTexture, uv);

			vAmount = bumpData.r; // get the r channel for height
			vec3 newPosition = position + normal * bumpScale * vAmount;
			gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition,1.0);
		}
	</script>

	<script type="x-shader/x-fragment" id="fragmentshader">
		#ifdef GL_ES
		precision highp float;
		#endif

		varying float vAmount;
		varying vec2 vUV;

		varying vec3 vNormal;

		void main()
		{
			vec3 light = vec3(0.5,0.8,0.0);
			light = normalize(light);
			float dProd = max(0.0, dot(vNormal,light));
			gl_FragColor 	= vec4(dProd/1.0,dProd/5.0,dProd/3.0,1.0);
			//gl_FragColor = vec4(1.0,1.0,1.0,1.0);
		}
	</script>

	<script src="/js/lib/jquery-1.11.0.min.js"></script>
	<script src="/js/lib/three.js"></script>
	<script src="/js/lib/socket.io.js"></script>

	<!-- this file has been intentionally left out of git, it contains ip and port of the node server running index.html
	var config = {
	  server:'<IPADDRESS>',
	  port:'<PORT>'
	};
	-->
	<script src="/js/src/serverconfig.js"></script>

	<script src="/js/src/FBOUtilities.js"></script>
	<script src="/js/src/display.js"></script>
</html>
